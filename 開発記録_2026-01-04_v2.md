# 開発記録 2026-01-04 (v2)

## 実施内容

### 1. simulation-engine.js 大幅修正

#### 初期状態の修正（constants.jsに準拠）
| 項目 | 修正前 | 修正後 |
|------|--------|--------|
| CASH | 100 | **112** |
| WORKERS | 3 | **1** |
| SALESMEN | なし | **1** |
| MATERIALS | 3 | **1** |
| WIP | 0 | **2** |
| PRODUCTS | 0 | **1** |
| chips | 空 | **computer:1, insurance:1** |
| currentRow | 1 | **2**（期首処理で1行使用済み）|

#### getSalesCapacity計算式の修正
```javascript
// 旧: workers + education
// 新: セールスマン×2 + min(広告チップ, セールスマン×2)×2 + min(教育チップ, 1)
getSalesCapacity() {
    if (this.salesmen === 0) return 0;
    const baseCapacity = this.salesmen * 2;
    const effectiveAdChips = Math.min(this.chips.advertising || 0, this.salesmen * 2);
    let capacity = baseCapacity + effectiveAdChips * 2;
    capacity += Math.min(this.chips.education || 0, 1);
    return capacity;
}
```

#### 2期長期借入禁止
```javascript
getLoanLimit: function(period, equity) {
    if (period === 2) return 0;  // 2期は長期借入禁止
    const multiplier = (period >= 4 && equity > 300) ? 1.0 : 0.5;
    return Math.floor(equity * multiplier);
}
```

#### 市場maxStock修正
| 市場 | 修正前 | 修正後 |
|------|--------|--------|
| 仙台 | 3 | 3 |
| 札幌 | 3 | **4** |
| 福岡 | 3 | **6** |
| 名古屋 | 3 | **9** |
| 大阪 | 3 | **13** |
| 東京 | 3 | **20** |
| 海外 | なし | **100** |

### 2. 64種類リスクカード完全実装

全64種類のリスクカードを正確に実装：
- クレーム発生(1-2): F+5
- 教育成功(3-4): 教育チップで32円販売
- 消費者運動(5-6): 販売不可
- 得意先倒産(7-8): 特別損失30（2期免除）
- 研究開発失敗(9-11): 青チップ返却
- 広告成功(12-14): 独占販売
- 労災発生(15-16): 生産不可
- 広告政策失敗(17-18): 赤チップ返却
- 特別サービス(19-20): 材料10円で5個
- 返品発生(21-23): 売上-20、製品+1
- コンピュータートラブル(24-25): F+10
- 商品の独占販売(26-28): 32円×5個
- 製造ミス発生(29-30): 仕掛品-1、特別損失14
- 倉庫火災(31-32): 材料全損、保険8円/個
- 縁故採用(33-34): F+5
- 研究開発成功(35-40): 32円×5個
- 各社共通(41-42): 12円で3個購入
- ストライキ(43-44): 1回休み
- 盗難発見(45-46): 製品2個損失、保険10円/個
- 長期労務紛争(47-48): 2回休み
- 設計トラブル(49-50): F+10
- ワーカー退職(51-52): F+5、ワーカー-1
- 景気変動(53-54): 逆回り
- 教育失敗(55-56): 黄チップ返却
- セールスマン退職(57-58): F+5、セールスマン-1
- 社長病気(59-60): 1回休み
- 不良在庫(61-62): 超過分損失、保険10円/個
- 機械故障(63-64): F+5

### 3. 期別・研究チップ別の記帳価格目安表

```javascript
TARGET_PRICES: {
    2: { 0: 24, 1: 26, 2: 28, 3: 30, 4: 32 },
    3: { 0: 24, 1: 26, 2: 28, 3: 30, 4: 32, 5: 34 },
    4: { 0: 22, 1: 24, 2: 26, 3: 28, 4: 30, 5: 32 },
    5: { 0: 21, 1: 23, 2: 25, 3: 27, 4: 29, 5: 31 }
}
```

### 4. 5種類のAI戦略タイプ実装

| 戦略タイプ | 会社名 | 特徴 |
|-----------|--------|------|
| RESEARCH_FOCUSED | 研究商事 | 青チップ3枚、高価格販売（+2円） |
| SALES_FOCUSED | 販売産業 | 広告2枚、セールスマン重視（-2円） |
| LOW_CHIP | 堅実工業 | チップ最小、安価販売（-4円） |
| BALANCED | バランス物産 | 柔軟な投資（±0円） |
| AGGRESSIVE | 積極製作所 | 早期大型機械（±0円） |

### 5. 確認したルール

#### 勝利条件
- 自己資本450円達成 **かつ** 在庫10個以上＋次期繰越チップ3枚以上
- 複数社達成時 → 自己資本が高い方が勝ち

#### 納税
- 初回（自己資本300超過時）: (超過分) × 50%
- 以降: G × 50%

#### チップ期末処理
- 2期末: 1枚返却、最大3枚繰越
- 3期以降: **会社盤のチップは全て没収**（次期繰越チップは残る）

#### 特別損失に含まれるもの
- 機械売却損（簿価×30%）
- 得意先倒産（30円）
- 公正取引委員会立入り（50円）
- 火災・盗難・不良在庫の在庫損失（評価額 - 保険金）

#### 在庫評価額（固定）
- 材料: 13円
- 仕掛品: 14円
- 製品: 15円

## テスト結果（100回シミュレーション）

- エラー: 0件
- 平均自己資本: ¥353
- 勝率: 39%
- 目標達成率: 0%（デフォルト戦略）

### 各社成績例
| 会社 | 自己資本 | 販売数 |
|------|----------|--------|
| 研究商事 | ¥440 | 26個 |
| あなた | ¥331 | 27個 |
| 積極製作所 | ¥304 | 24個 |
| バランス物産 | ¥300 | 24個 |
| 販売産業 | ¥294 | 31個 |
| 堅実工業 | ¥233 | 30個 |

## 次の作業
- ブラウザ版ゲームへのAI実装
- 毎期毎行の詳細記録機能
- 10,000回シミュレーションによる最適戦略分析

*作成日: 2026-01-04*
