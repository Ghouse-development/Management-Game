# MG (Management Game) シミュレーションシステム

## 概要
6社で競争するビジネスシミュレーションゲーム。2期～5期を通して自己資本¥450以上を目指す。

---

## システム構成

```
Management Game/
├── mg-simulation.js              # エントリポイント（検証+実行）
├── CLAUDE.md                     # このファイル
├── js/
│   ├── simulation-engine.js      # ルール定義+シミュレーションエンジン
│   └── intelligent-learning.js   # Q学習システム v2.0
├── data/
│   ├── q-learning-data.json      # Q学習データ（状態-行動価値）
│   └── learned-strategies.json   # 戦略統計データ
├── rules/
│   ├── rules-checklist.json      # 全84ルールのチェックリスト
│   └── verify-rules.js           # チェックリスト検証
└── tests/
    ├── rule-tests.js             # ルール単体テスト（84項目）
    └── behavior-tests.js         # 動作確認テスト
```

---

## 実行方法

```bash
# シミュレーション実行（検証込み）
node mg-simulation.js        # 1回実行
node mg-simulation.js 1000   # 1000回実行

# テスト実行
node tests/rule-tests.js     # 84項目ルールテスト
node rules/verify-rules.js   # チェックリスト検証
```

---

## Q学習システム v2.0

### 概要
- **状態空間**: 約260状態（期×進捗×現金×製品×生産可能×研究チップ）
- **行動タイプ**: SELL, BUY_MATERIALS, PRODUCE, BUY_CHIP, HIRE_*, DO_NOTHING等
- **学習率**: 0.15、割引率: 0.95、探索率: 25%→5%（自動調整）

### 状態エンコード形式
```
例: "5M_H_YN_L"
     │ │  ││  └─ 研究チップ: L=0-2枚, H=3-5枚
     │ │  │└──── 生産可能: Y/N
     │ │  └───── 製品あり: Y/N
     │ └──────── 現金: L=低, M=中, H=高
     └────────── 期+進捗: 5M=5期中盤
```

### 会社別トラッカー
各会社の行動履歴を分離管理（v1.0のバグ修正済み）

---

## ルール強制システム

### 1. RuntimeRuleEnforcer
全ての状態変更後に自動検証。違反があれば即エラー。

### 2. ActionValidator
アクション実行前に事前検証。無効な行動は実行されない。

### 3. RuleValidator
シミュレーション開始時にルール定義の存在を確認。

---

## 主要ルール（84項目）

### ゲーム構造
- 6社競争（プレイヤー1社 + AI5社）
- 期別行数: 2期=20行, 3期=30行, 4期=34行, 5期=35行
- 親ボーナス+2

### 入札システム
- 入札市場: 仙台・札幌・福岡・名古屋
- 非入札市場: 大阪（サイコロ21-26）、東京（固定20）、海外（固定16）
- コール価格 = 希望価格 - 研究チップ×2 - 親ボーナス2

### 勝利条件
- 自己資本¥450以上
- 在庫10個以上
- 次期繰越チップ3枚以上
- 6社中1位

---

## 更新履歴

- 2026-01-04: Q学習v2.0
  - 会社別トラッカーで行動履歴分離（混入バグ修正）
  - 状態空間を8036→260に削減（学習効率向上）
  - 期首処理・リスクカードの学習追加
  - 不要ファイル・古い学習システム削除
- 2026-01-04: 84項目全て実装・検証済み
- 2026-01-04: 統一エンジン作成、親の定義を正しく実装
