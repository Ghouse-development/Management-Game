# MG (Management Game) - 正規ルールブック

このファイルはゲームの正規ルールを記録する。実装時はこのファイルを参照すること。

---

## 1. ゲーム構造

### 1.0 2期開始時の初期状態（重要）
| 項目 | 値 | 備考 |
|------|-----|------|
| 期首現金（処理前） | 137円 | 前期繰越 |
| PC・保険購入（1行目） | -25円 | PC 20円 + 保険 5円（強制購入） |
| **期首現金（処理後）** | **112円** | 2行目開始時の現金 |
| 材料 | 1個 | |
| 仕掛品 | 2個 | |
| 製品 | 1個 | |
| 小型機械 | 1台 | 製造能力1 |
| ワーカー | 1人 | |
| セールスマン | 1人 | 販売能力2 |
| 自己資本 | 283円 | 目標450円 |
| 開始行 | 2行目 | 1行目はPC・保険購入で使用済み |

**注意**:
- **2期は借入不可**（3期以降のみ長期借入可能）
- **2期**: PC・保険は初期状態で購入済み（強制）
- **3期以降**: PC・保険は選択可能（現金があれば自動購入、なければスキップ可能）

### 1.1 期と行数
| 期 | 行数上限 | 備考 |
|----|----------|------|
| 2期 | 20行 | ゲーム開始期 |
| 3期 | 30行 | サイコロあり |
| 4期 | 34行 | サイコロあり |
| 5期 | 35行 | サイコロあり、最終期 |

### 1.2 ターン順
- 6社（プレイヤー1社 + AI5社）が順番にプレイ
- 1周で全社が1回ずつ行動
- 景気変動カードで逆回りになる場合あり
- **順番飛ばしは絶対に発生しない**

### 1.3 期の終了条件
- **誰か1社でも規定行数に到達した時点で、全社強制終了**
- 告知モーダル → 決算処理へ

---

## 2. サイコロ（3期以降）

### 2.1 誰が振るか
- **前期のPQトップ（売上高1位）の会社が振る**

### 2.2 サイコロ結果
| 目 | 人件費倍率 | 市場閉鎖 | 大阪上限 |
|----|-----------|----------|----------|
| 1-3 | ×1.1 | 仙台のみ | 21-23円 |
| 4-6 | ×1.2 | 仙台+札幌 | 24-26円 |

- 大阪上限価格 = 20 + サイコロの目

---

## 3. 入札システム

### 3.1 基本ルール
- **親（意思決定カードを引いた人）は販売数量のみ決める**
- 各入札者は自分の「プライスカード（表示価格）」を決める

### 3.2 価格の種類
| 名称 | 計算式 | 用途 |
|------|--------|------|
| プライスカード（表示価格） | 入札者が決定 | PQ計算（記帳価格） |
| コール価格 | 表示価格 - 競争力 | 勝敗判定 |

### 3.3 価格競争力
```
競争力 = 研究チップ × 2 + 親ボーナス(2)
```
- 研究チップ1枚 = +2
- 親である = +2

### 3.4 勝敗判定（優先順位）
1. コール価格が低い方が勝ち（第一優先）
2. 同じなら、研究チップ枚数が多い方が勝ち
3. それでも同じなら、親が勝ち

### 3.5 販売上限
- **親が決めた数量が、全入札者の販売上限**

---

## 4. 能力計算

### 4.1 製造能力
```
機械能力 = 小型機械(1) + アタッチメント(+1) + 大型機械(4) + PCチップ
ワーカー能力 = ワーカー数 + 教育チップ効果(最大+1)
製造能力 = min(機械能力, ワーカー能力)
```
- ワーカー0人 → 製造能力0
- ワーカー < 機械台数 → ボトルネック

### 4.2 販売能力
```
基本能力 = セールスマン × 2
有効広告 = min(広告チップ数, セールスマン × 2)
広告効果 = 有効広告 × 2
教育効果 = min(教育チップ数, 1)
販売能力 = 基本能力 + 広告効果 + 教育効果
```
- セールスマン0人 → 販売能力0（広告・教育チップがあっても）

### 4.3 計算例
セールスマン3人 + 広告2枚 + 教育1枚:
- 基本 = 3 × 2 = 6
- 有効広告 = min(2, 6) = 2
- 広告効果 = 2 × 2 = 4
- 教育効果 = 1
- **販売能力 = 6 + 4 + 1 = 11**

---

## 5. チップシステム

### 5.1 チップ種類と効果
| チップ | 効果 | コスト |
|--------|------|--------|
| 研究（青） | 価格競争力+2/枚 | 通常20円、特急40円 |
| 教育（黄） | 製造+1、販売+1（最大効果+1） | 通常20円、特急40円 |
| 広告（赤） | 販売能力向上 | 通常20円、特急40円 |
| PC（緑） | 製造能力+1 | 20円 |
| 保険（橙） | 災害時補償 | 5円 |

### 5.2 購入上限
| チップ | 2期 | 3期以降 |
|--------|-----|---------|
| 教育 | 2枚 | 1枚 |
| 研究 | 5枚 | 5枚 |
| 広告 | 5枚 | 5枚 |

### 5.3 繰越ルール
- **2期末**: 研究・教育・広告は1枚減って繰越（最大3枚）、PC・保険は返却
- **3-5期末**: 全チップ没収、次期予約チップのみ繰越

---

## 6. 会計

### 6.1 基本公式
```
PQ = 売上高（販売単価 × 販売数量）
VQ = 変動費（材料費 + 製造費 + 期首在庫 - 期末在庫）
MQ = 限界利益 = PQ - VQ
F = 固定費（給料 + 減価償却 + チップ + 金利 + その他）
G = 経常利益 = MQ - F - 特別損失
```

### 6.2 在庫評価額
| 在庫 | 単価 |
|------|------|
| 材料 | 13円 |
| 仕掛品 | 14円 |
| 製品 | 15円 |

### 6.3 給与計算
```
基本単価: 2期=22円、3期=24円、4期=26円、5期=28円
3期以降: 基本単価 × wageMultiplier(1.1 or 1.2)

給料 = 機械台数×単価 + ワーカー×単価 + セールスマン×単価 + 期中最大人員×半額単価
```

### 6.4 チップのF計算（重要）

#### 2期の場合
```
F = (今期購入枚数 - 次期繰越枚数) × 20円
```
- **購入枚数**: リスクカードで没収されたチップも含む（購入履歴でカウント）
- **繰越枚数**: min(期末所持枚数, 3) - 1

**例**: 研究チップを4枚購入 → リスクカードで1枚没収 → 再度1枚購入
- 購入枚数 = 5枚
- 期末所持 = 4枚 → 繰越 = min(4,3)-1 = 2枚
- **F = (5 - 2) × 20 = 60円**

#### 3期以降の場合
```
F = 繰越チップ × 20円 + 特急チップ × 40円
```
- **繰越チップ**: 前期末から繰り越されたチップ（今期使用分）
- **特急チップ**: 今期に特急購入したチップ（40円払ったもの）
- **次期予約**: 今期のFには含まない（来期のFに算入）

**例**: 3期開始時に研究チップ3枚繰越 → リスクカードで1枚没収 → 次期繰越で2枚購入
- 繰越 = 3枚 × 20円 = 60円
- 特急 = 0枚 × 40円 = 0円
- 次期予約 = 2枚（来期のFに算入、今期は含まない）
- **F（研究チップ分）= 60円**

---

## 7. 税金・配当

### 7.1 計算ルール
- **初回300円超過時**: 超過分の50%が税金、20%が配当
- **既に300円超でG>0の場合**: Gの50%が税金、10%が配当
- **G≤0の場合**: 税金・配当なし

### 7.2 自己資本計算
```
次期自己資本 = 今期自己資本 + G - 税金
```

---

## 8. 倉庫

- 期首に購入可能（1個20円、容量+12）
- 材料倉庫 or 製品倉庫を選択
- 災害から保護
- **期末で消滅（Fに算入済み）**

---

## 9. 期首・期末処理

### 9.1 期首処理
1. 金利支払い（長期10%、短期20%）
2. 納税・配当支払い
3. PC・保険チップ購入（任意）
4. 倉庫購入（3期以降、任意）
5. 長期借入（3期以降、任意）

### 9.2 期末処理
1. 決算計算（PQ/VQ/MQ/F/G）
2. 税金・配当計算
3. 給料支払い
4. 借入返済（長期10%以上、短期20%以上）
5. チップ返却/繰越

---

## 10. 次期への遷移

1. 決算表示後「次期へ進む」ボタンをクリック
2. **勝手に次期が始まることはない**
3. 3期以降は前期PQトップがサイコロを振る
4. サイコロ結果表示 → 借入選択 → 期開始

---

## 11. 短期借入（重要）

### 11.1 発生条件
短期借入は**意図的に行うことはできない**。以下の場合のみ自動発生：
- リスクカード（得意先倒産など）で予期せぬ現金マイナス
- 給料・返済支払い時に現金不足（材料売却でも払えない場合）

### 11.2 借入不可のケース
以下の購入・投資で借金することは**不可**：
- 材料購入
- チップ購入（研究・教育・広告・PC・保険）
- 製造（加工費）
- 採用（ワーカー・セールスマン）
- 設備投資（機械・倉庫）

**→ 現金不足の場合はアクション実行不可**

### 11.3 金利とF計算
```
借入時: 20%控除（100円借りて80円受取）→ 今期のF
次期期首: 残元本×20%の金利支払い → 次期のF
```

### 11.4 返済
- 期末に最低20%以上返済必須
- 全額返済も可能

### 11.5 AI行動指針
- 短期借入が発生しないよう計画的にプレイ
- 期末支払いを常に意識して現金管理
- DO NOTHINGは禁止（何らかの行動を取る）

---

## 更新履歴
- 2024-12-30: 初版作成
- 2025-12-30: チップのF計算ルール（6.4節）追加
- 2025-12-30: 短期借入ルール（11節）追加
