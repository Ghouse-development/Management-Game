# 開発記録 2026-01-03

## 実施内容

### 1. シミュレーションエンジン作成 (`js/simulation-engine.js`)
- Node.js/ブラウザ両対応の完全シミュレーター
- 正確なゲームルール実装:
  - 小型機械: 製造能力1、コスト100円、減価償却10円
  - 大型機械: 製造能力4、コスト200円、減価償却20円
  - アタッチメント: +1製造能力、コスト30円、減価償却3円
- 6社同時シミュレーション
- 期末処理（人件費、減価償却、借入返済、チップ繰越）

### 2. 行動評価システム (`js/action-evaluator.js`)
- 各行動のスコアリング
- ROI計算
- 最適手との比較評価
- ゲーム終了時の総合評価

### 3. 戦略最適化エンジン (`js/strategy-optimizer.js`)
- モンテカルロシミュレーション
- 遺伝的アルゴリズムによる最適化
- 戦略パラメータの自動探索

### 4. CLIテストランナー (`run-simulation.js`)
```bash
node run-simulation.js --runs 100    # 基本シミュレーション
node run-simulation.js --optimize    # 遺伝的アルゴリズム
node run-simulation.js --verbose     # 詳細ログ
```

### 5. 入札ルール修正 (`js/bidding.js`)
- 正しい優先順位:
  1. コール価格が低い方が勝ち
  2. 同じなら研究チップ枚数が多い方が勝ち
  3. それでも同じなら親が勝ち
  4. 親以外同士ならランダム

### 6. リスクカード完全実装
15種類のリスクカード効果:
- クレーム発生 (F+5) x2
- 教育成功 (32円販売) x2
- 消費者運動発生 (販売不可) x2
- 得意先倒産 (特別損失30円、2期免除) x2
- 研究開発失敗 (チップ-1) x3
- 広告成功 (独占販売) x2
- 火災発生 (製品損失)
- 労働争議 (生産停止)

### 7. 入札勝率モデル精密化
- 6社競争シミュレーション
- 研究チップ・親ボーナス考慮
- 競争者数に基づく勝率計算

## ルール確認事項（コード化済み）
- 短期借入: 20%返済、長期借入: 10%返済（期末のみ）
- 長期借入: 期首のみ、利息即差引
- 大型機械: 常に200円、小型機械: 常に100円
- 機械売却: 簿価×70%
- 採用: 5円/人、1行最大3人、退職5円、縁故採用5円（1名のみ）
- チップ繰越: 2期のみ（1枚返却、最大3枚）、3期以降は全クリア
- 機械1台につきワーカー1名必要

## 次の作業
- 10,000回シミュレーションによる最適戦略分析
- 各パラメータ（チップ、借入、倉庫、機械構成）の最適値探索
- 結果をAIコードに反映
